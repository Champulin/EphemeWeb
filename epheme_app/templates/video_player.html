{% extends "__layout.html" %}

{% block content %}
<main>
  <h1>
    {{ video.title }}
  </h1>
  <section class="player">
    {% if video.source_name == 'youtube'%}
    <div id="ytplayer">
    </div>
    {% else %}
    <div id="{name}"></div>
    {% endif %}
  </section>

  <section class="info">
    <h2>
      {{video.author}}
    </h2>
    <p>
      {{ video.description }}
    </p>
    <p>
      <a href="{{video.category_name.get_absolute_url}}">{{video.category_name}}</a>
    </p>
    <p>
      {{video.date}}
    </p>
    <p>
      {{video.tags}}
    </p> 
  </section>
</main>

<script>
  const url = "{{ video.video_url }}";
  const source = "{{ source_name }}";

  function playOnYoutube() {
    function getYoutubeId(url){
      const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
      const match = url.match(regExp);
      return (match&&match[7].length==11)? match[7] : false;
    }
    const id = getYoutubeId(url);
    function onYouTubePlayerAPIReady() {
      player = new YT.Player('ytplayer', {
        height: '100%',
        width: '100%',
        videoId: id,
        playerVars: { 'modestbranding': 1, 'rel': 0, 'controls': 1 },
      });
    }
  }

  function playOnVimeo() {
    const options = {
      url: url
    };

    const player = new Vimeo.Player('video-player', options);

    player.on('play');
  }

  switch (source) {
    case "youtube":
      playOnYoutube();
      break;
    case "vimeo":
      playOnVimeo();
    default:
      break;
  }
</script>


<style>
  #video-player {
    aspect-ratio: 16/9;
  }

  main {
    flex-grow: 1;
    display: flex;
    justify-self: center;
    flex-direction: column;
    justify-content: center;
    align-content: center;
  }

  .main {
    height: 100vh;
  }
</style>
{% endblock %}