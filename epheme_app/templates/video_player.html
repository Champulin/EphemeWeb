{% extends "__layout.html" %}

{% block content %}
<main>
  <h1>
    {{ video.title }}
  </h1>
  <section class="player">
    {% if video.source_name == 'youtube'%}
    <div id="ytplayer">
    </div>
    {% else %}
    <div id="{name}"></div>
  </section>
  <section class="info">
    <h2>
      {{video.author}}
    </h2>
    <p>
      {{ video.description }}
    </p>
    <p>
      <a href="{{video.category_name.get_absolute_url}}">{{video.category_name}}</a>
    </p>
    <p>
      {{video.date}}
    </p>
    <p>
      {{video.tags}}
    </p> 
  </section>
</main>

<script>
  function youtube_parser(url){
    var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
    var match = url.match(regExp);
    return (match&&match[7].length==11)? match[7] : false;
  }
  // Load the IFrame Player API code asynchronously.
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/player_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  var id = youtube_parser("{{ video.video_url }}");
  

  // Replace the 'ytplayer' element with an <iframe> and
  // YouTube player after the API code downloads.
  var player;
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('ytplayer', {
      height: '100%',
      width: '100%',
      videoId: id,
      playerVars: { 'modestbranding': 1, 'rel': 0, 'controls': 1 },
    });
  }
</script>


<style>
  #ytplayer {
    aspect-ratio: 16/9;
  }

  main {
    flex-grow: 1;
    display: flex;
    justify-self: center;
    flex-direction: column;
    justify-content: center;
    align-content: center;
  }
</style>
{% endblock %}